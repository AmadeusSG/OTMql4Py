<!DOCTYPE html>
<html>
<!-- This file is automatically generated: do not edit. -->
<head>
<title>Architecture</title>
<meta charset="utf-8">
</head>
<body>
<!-- <h1>Architecture</h1> -->
<h3>Mt4 and Python Architecture</h3>

<p>Mt4 runs an expert attached to a chart in a thread.<br />
Python in a Mt4 expert starts a main thread that is unique to the<br />
application, and starts another worker thread. The main thread is blocked<br />
until Python is unloaded, and everything takes place in the worker thread.<br />
The worker thread can start more threads.</p>

<p>You can send commands from Mt4 to Python, but Python can't send commands<br />
to Mt4. So what you can do is queue up things for Mt4 to do, and<br />
periodically get Mt4 to ask Python if it has anything it wants Mt4 to do.<br />
It's easiest to think of registering an EventTimer with your expert, and<br />
to have <tt>OnTimer</tt> function periodically ask Python if it has any work.<br />
(Remember that <tt>EventTimer</tt> events fire even if the market is closed or<br />
you have no connection, unlike <tt>OnTick</tt> events.)</p>

<p>The problem is that Mt4 does not have an <tt>Eval</tt> command, so if Python wants<br />
Mt4 to do something, like <tt>OrderSend</tt>, we can't just pass a string to Mt4<br />
that says <tt>OrderSend(...)</tt> and expect Mt4 to eval it: there is no eval.<br />
So what we have done is write a simplistic replacement to what should<br />
be an <tt>Eval</tt> command in Mt4, that will parse as string and execute it.<br />
See that function <tt>zMt4LibProcessCmd</tt> in<br />
<tt>MQL4/Libraries/OTMql4/OTLibMt4ProcessCmd.mq4</tt> of the <tt>OTMql4Lib</tt><br />
package (https://github.com/OpenTrading/OTMql4Lib/).  See also<br />
<tt>OTLibProcessCmd.mq4</tt> for an example of how to extend<br />
<tt>zMt4LibProcessCmd</tt> to process your own functions.</p>

<p>This is not a proper replacement to an <tt>Eval</tt> function. It only executes<br />
commands that it knows about, and has no ability to decipher complex commands.<br />
Still, it allows Python to make decisions and ask Mt4 to do things,<br />
which is enough for order and account processing. You can use this for<br />
bi-directional interaction with a program outside of Mt4. For example,<br />
you could use a call from <tt>OnTick</tt> into Python to send tick and bar info<br />
to another program, and then use a call from <tt>OnTimer</tt> into Python to<br />
ask if there are any requests back from the program that it wants Mt4<br />
to evaluate.</p>

<p>You may also want to use threads and queues within Python to make sure<br />
that any command that you ask Python to execute is accomplished within<br />
the time it takes to get the next tick: programming with Python iterators<br />
is probably a good idea. It is untested as to whether<br />
the Python code dispatched from <tt>OnTick</tt> can block the chart or not.</p>

<p>In our demo experts, we have set the timer interval to be quite high:<br />
10 seconds.  What you attach the expert to the chart, you can set it<br />
to what you want.  It's set high for testing; obviously if you have a<br />
lot of charts with OTMqlPy and set the interval low, it may add a lot<br />
of work to Mt4.</p></body>
</html>
